{"remainingRequest":"/web/vue/19-项目开发/supermall/node_modules/vue-loader/lib/index.js??vue-loader-options!/web/vue/19-项目开发/supermall/src/views/detail/Detail.vue?vue&type=style&index=0&id=117d0e76&scoped=true&lang=css&","dependencies":[{"path":"/web/vue/19-项目开发/supermall/src/views/detail/Detail.vue","mtime":1596093057105},{"path":"/web/vue/19-项目开发/supermall/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/web/vue/19-项目开发/supermall/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/web/vue/19-项目开发/supermall/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/web/vue/19-项目开发/supermall/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/web/vue/19-项目开发/supermall/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiNkZXRhaWwgewogIGhlaWdodDogMTAwdmg7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIHotaW5kZXg6IDk7CiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsKfQouY29udGVudCB7CiAgaGVpZ2h0OiBjYWxjKDEwMCUgLSA0NHB4IC0gNThweCk7Cn0KLmRldGFpbC1uYXYgewogIHBvc2l0aW9uOiByZWxhdGl2ZTsKICB6LWluZGV4OiA5OwogIGJhY2tncm91bmQtY29sb3I6ICNmZmY7Cn0K"},{"version":3,"sources":["Detail.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8LA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Detail.vue","sourceRoot":"src/views/detail","sourcesContent":["<template>\n  <div id=\"detail\">\n\n    <detail-nav-bar class=\"detail-nav\" @titleClick=\"titleClick\" ref=\"nav\"/>\n    <scroll class=\"content\"\n            ref=\"scroll\"\n            :probe-type=\"3\"\n            @scroll=\"contentScroll\">\n      <!--属性使用驼峰：topImages 传入值应该用-分隔 top-images -->\n      <detail-swiper :top-images=\"topImages\"/>\n      <detail-base-info :goods=\"goods\"></detail-base-info>\n      <detail-shop-info :shop=\"shop\"></detail-shop-info>\n      <detail-goods-info :detail-info=\"detailInfo\" @imageLoad=\"imageLoad\"></detail-goods-info>\n      <detail-param-info :param-info=\"paramInfo\" ref=\"params\"></detail-param-info>\n      <detail-comment-info :comment-info=\"commentInfo\" ref=\"comment\"></detail-comment-info>\n      <goods-list :goods=\"recommends\" ref=\"recommend\"></goods-list>\n    </scroll>\n    <detail-bottom-bar @addCart=\"addToCart\"/>\n    <back-top @click.native=\"backClick\" v-show=\"isShowBackTop\"></back-top>\n  </div>\n</template>\n\n<script>\n  import DetailNavBar from \"./childComps/DetailNavBar\";\n  import DetailSwiper from \"./childComps/DetailSwiper\";\n  import DetailBaseInfo from \"./childComps/DetailBaseInfo\";\n  import DetailShopInfo from \"./childComps/DetailShopInfo\";\n  import DetailGoodsInfo from \"./childComps/DetailGoodsInfo\";\n  import DetailParamInfo from \"./childComps/DetailParamInfo\";\n  import DetailCommentInfo from \"./childComps/DetailCommentInfo\";\n  import DetailBottomBar from \"./childComps/DetailBottomBar\";\n\n  import Scroll from \"components/common/scroll/Scroll\"\n  import GoodsList from \"components/content/goods/GoodsList\";\n  import {debounce} from \"common/utils\";\n\n  import {getDetail, Goods, Shop, GoodsParam} from \"network/detail\";\n  import {getRecommend} from \"network/detail\";\n  import {backTopMixin} from \"common/mixin\";\n\n  export default {\n    name: \"Detail\",\n    components: {\n      DetailNavBar,\n      DetailSwiper,\n      DetailBaseInfo,\n      DetailShopInfo,\n      DetailGoodsInfo,\n      DetailParamInfo,\n      DetailCommentInfo,\n      Scroll,\n      GoodsList,\n      DetailBottomBar\n    },\n    mixins: [backTopMixin],\n    data() {\n      return {\n        iid: null,\n        topImages: [],\n        goods: {},\n        shop: {},\n        detailInfo: {},\n        paramInfo: {},\n        commentInfo: {},\n        recommends: [],\n        themeTopYs: [],\n        getThemeTopY: null,\n        currentIndex: 0\n      }\n    },\n    created() {\n      //1、获取iid\n      this.iid = this.$route.params.iid\n      //2、根据iid请求详情数据\n      getDetail(this.iid).then(res => {\n        // console.log(res);\n        const data = res.result;\n        //2、获取顶部的图片数据\n        this.topImages = data.itemInfo.topImages\n        //3、获取商品基本信息\n        this.goods = new Goods(data.itemInfo,data.columns,data.shopInfo.services)\n        //4、获取店铺信息\n        this.shop = new Shop(data.shopInfo)\n        //5、获取商品详细信息\n        this.detailInfo = data.detailInfo\n        //6、获取商品参数信息\n        this.paramInfo = new GoodsParam(data.itemParams.info,data.itemParams.rule)\n        //7、获取商品评论信息(有的商品没有评论，所以需要先做一个判断)\n        if(data.rate.cRate !== 0) {\n          this.commentInfo = data.rate.list[0]\n        }\n        //nextTick这个函数，是根据最新的数据，对应的DOM已经被渲染出来了，但是图片依然没有加载完\n        //所以获取到的offsetTop的值是不包括图片的，有错误\n        // this.$nextTick(() => {\n        //   this.themeTopYs = []\n        //\n        //   this.themeTopYs.push(0);\n        //   //参数的offsetTop\n        //   this.themeTopYs.push(this.$refs.params.$el.offsetTop);\n        //   //评论的offsetTop\n        //   this.themeTopYs.push(this.$refs.comment.$el.offsetTop);\n        //   //推荐的offsetTop\n        //   this.themeTopYs.push(this.$refs.recommend.$el.offsetTop);\n        //\n        //   console.log(this.themeTopYs);\n        // })\n\n      })\n      //3、请求商品推荐数据\n      getRecommend().then(res => {\n        // console.log(res);\n        this.recommends = res.data.list\n      })\n      //4、给getThemeTopY赋值(对给this.themeTopYs赋值的操作进行防抖)\n      this.getThemeTopY = debounce(() => {\n        this.themeTopYs = []\n        this.themeTopYs.push(0);\n        //参数的offsetTop，减去顶部导航的高度44px\n        this.themeTopYs.push(this.$refs.params.$el.offsetTop - 44);\n        //评论的offsetTop\n        this.themeTopYs.push(this.$refs.comment.$el.offsetTop - 44);\n        //推荐的offsetTop\n        this.themeTopYs.push(this.$refs.recommend.$el.offsetTop - 44);\n        //给数组添加一个最大值\n        this.themeTopYs.push(Number.MAX_VALUE)\n\n        // console.log(this.themeTopYs);\n      },100)\n    },\n    mounted() {\n      //图片加载完成的事件监听\n      const refresh = debounce(this.$refs.scroll.refresh,200)\n      //监听GoodsListItem中图片加载完成\n      this.$bus.$on('detailItemImageLoad',() => {\n        refresh()\n      })\n    },\n    methods: {\n      imageLoad() {\n        this.$refs.scroll.refresh()\n        this.getThemeTopY()\n      },\n      titleClick(index) {\n        // console.log(index);\n        this.$refs.scroll.scrollTo(0,-this.themeTopYs[index],200)\n      },\n      contentScroll(position) {\n        // console.log(position);\n        //1、获取滚动的Y值\n        const positionY = -position.y\n        //2、positionY和主题中值进行对比，决定当前应该显示哪个index\n        // 如果当前主题的值为[0, 6211, 7029, 7244]\n        // console.log(Number.MAX_VALUE);\n        // positionY 大于等于0 和 小于6211 之间，index = 0\n        // positionY 大于等于6211 和 小于7029 之间，index = 1\n        // positionY 大于等于7029 和 小于7244 之间，index = 2\n        // positionY 大于等于7244 值，index = 3\n        let length = this.themeTopYs.length\n        //因为额外添加了一个最大值，最后一个值没有意义，所以只要遍历前四个值即可\n        for(let i=0; i < length-1; i++) {\n          // if(this.currentIndex !== i && ((i < length - 1 && positionY >= this.themeTopYs[i] && positionY < this.themeTopYs[i+1]) || (i === length -1 && positionY >= this.themeTopYs[i]))){\n          //   this.currentIndex = i;\n          //   // console.log(this.currentIndex);\n          //   this.$refs.nav.currentIndex = this.currentIndex\n          // }\n          if (this.currentIndex !==i && (positionY >= this.themeTopYs[i] && positionY < this.themeTopYs[i+1] )) {\n            this.currentIndex = i;\n            this.$refs.nav.currentIndex = this.currentIndex\n          }\n          //判断BackTop是否显示\n          this.isShowBackTop = (-position.y) > 800\n        }\n      },\n      addToCart() {\n        //1、先获取购物车需要展示的信息\n        const product = {}\n        product.image = this.topImages[0];\n        product.title = this.goods.title;\n        product.desc = this.goods.desc;\n        product.price = this.goods.realPrice;\n        product.iid = this.iid;\n        //2、用commit调用index.js里mutations的addCart方法\n        // this.$store.commit('addCart',product)\n        this.$store.dispatch('addCart',product)\n      }\n    }\n  }\n</script>\n\n<style scoped>\n  #detail {\n    height: 100vh;\n    position: relative;\n    z-index: 9;\n    background-color: #fff;\n  }\n  .content {\n    height: calc(100% - 44px - 58px);\n  }\n  .detail-nav {\n    position: relative;\n    z-index: 9;\n    background-color: #fff;\n  }\n</style>"]}]}